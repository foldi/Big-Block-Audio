/**
 * Big Block Audio
 * Copyright (C) 2011 Foldi, LLC
 * Licensed under the MIT license.
 *
 * Provides an interface to play audio files in an HTML 5 compliant web browser.
 * 
 * @author Vince Allen 01-01-2011
 * 
 * version 1.0
 */
function f(n){throw n;}var i=true,l=false;
BigBlockAudio=function(){var n,p;n=function(b){var c;try{if(BigBlockAudio.m){c=document.createTextNode(b+"\n");BigBlockAudio.m.appendChild(c)}else if(typeof console!=="undefined")console.log(b);else typeof opera!=="undefined"&&opera.postError(b)}catch(d){}};p=i;if(typeof window.A==="undefined"){p=l;n("This browser does not support HTML5 audio.")}return{M:navigator.userAgent.toLowerCase(),d:p,a:{},w:null,m:null,f:l,k:i,filename:null,n:500,u:(new Date).getTime(),muted:l,h:["wav","ogg","mp3"],g:[],l:l,
i:l,B:l,add:function(b,c,d,e,h){var g,j,k,m;if(p){try{if(typeof b==="undefined")f(Error("An id is required"));if(typeof c==="undefined")f(Error("Path to audio file required"))}catch(q){BigBlockAudio.b(q.name+": "+q.message)}typeof e==="function"&&e(b);for(e=0;e<this.h.length;e++){j=BigBlockAudio.q(this.h[e]);m=new Audio(c+b+"."+this.h[e]);m.I="metadata";m.autoplay=l;if(d)m.loop=d;k="";for(g=0;g<j.length;g++){k=this.canPlayType(m,j[g]);if(k!==""){this.f&&BigBlockAudio.b("This browser will try to play "+
b+" audio file in "+j[g]+" format.");break}}if(k!=="")break}if(k!==""){m.id=b;this.a[b]=m;g=this.a[b];if(g.addEventListener){g.addEventListener("loadeddata",function(o){h&&typeof h==="function"?BigBlockAudio.c(o,h(o)):BigBlockAudio.c(o)},l);g.addEventListener("loadstart",BigBlockAudio.c,l);g.addEventListener("progress",BigBlockAudio.c,l);g.addEventListener("suspend",BigBlockAudio.c,l);g.addEventListener("abort",BigBlockAudio.c,l);g.addEventListener("error",BigBlockAudio.c,l);g.addEventListener("emptied",
BigBlockAudio.c,l);g.addEventListener("stalled",BigBlockAudio.c,l)}else if(a.attachEvent){g.attachEvent("loadeddata",function(o){BigBlockAudio.c(o,h)},l);g.attachEvent("loadstart",BigBlockAudio.c,l);g.attachEvent("progress",BigBlockAudio.c,l);g.attachEvent("suspend",BigBlockAudio.c,l);g.attachEvent("abort",BigBlockAudio.c,l);g.attachEvent("error",BigBlockAudio.c,l);g.attachEvent("emptied",BigBlockAudio.c,l);g.attachEvent("stalled",BigBlockAudio.c,l)}if(g.load){this.g.push(b);this.v(b)}else{this.d=
l;this.a=[];BigBlockAudio.b("This browser does not support HTML5 audio.")}}else{BigBlockAudio.b("Audio mime-type "+j+" not supported. "+this.h+" files will not be played.");if(BigBlockAudio.k){BigBlockAudio.d=l;BigBlockAudio.a=[]}}}},c:function(b,c){var d,e;e="An audio event ("+b.type+") for "+b.target.id+" just fired.";switch(b.type){case "loadstart":e="BigBlockAudio: eventHandler: Audio file "+b.target.id+" has started loading.";break;case "progress":e="BigBlockAudio: eventHandler: Audio file "+
b.target.id+" is loading.";break;case "suspend":e="BigBlockAudio: eventHandler: The user agent is intentionally not currently fetching "+b.target.id+", but does not have the entire media resource downloaded.";break;case "abort":e="BigBlockAudio: eventHandler: The user agent stopped fetching "+b.target.id+" before it was completely downloaded, but not due to an error.";break;case "error":e="BigBlockAudio: eventHandler: An error occurred while fetching "+b.target.id+".";if(BigBlockAudio.k){BigBlockAudio.d=
l;BigBlockAudio.a=[]}break;case "emptied":e="BigBlockAudio: eventHandler: "+b.target.id+"'s network state just switched to NETWORK_EMPTY.";break;case "stalled":e="BigBlockAudio: eventHandler: The user agent is trying to fetch "+b.target.id+", but data is unexpectedly not forthcoming.";break;case "loadeddata":if(!BigBlockAudio.a[b.target.id].loaded){e="BigBlockAudio: eventHandler: Audio file "+b.target.id+" is ready to play.";typeof c==="function"&&!BigBlockAudio.l&&setTimeout(function(){c()},0);BigBlockAudio.a[b.target.id].loaded=
i}}if(b.type!=="loadstart"&&b.type!=="progress"&&b.type!=="suspend"&&b.type!=="emptied"&&b.type!=="stalled"){if(!BigBlockAudio.l)for(d=0;d<BigBlockAudio.g.length;d++)if(BigBlockAudio.g[d]===b.target.id){BigBlockAudio.g.splice(d,1);if(BigBlockAudio.g.length<1){BigBlockAudio.l=i;BigBlockAudio.i&&typeof BigBlockAudio.i==="function"&&BigBlockAudio.i()}break}if(BigBlockAudio.a[b.target.id]){BigBlockAudio.a[b.target.id].removeEventListener("loadeddata",this.c,l);BigBlockAudio.a[b.target.id].removeEventListener("loadstart",
this.c,l);BigBlockAudio.a[b.target.id].removeEventListener("progress",this.c,l);BigBlockAudio.a[b.target.id].removeEventListener("suspend",this.c,l);BigBlockAudio.a[b.target.id].removeEventListener("abort",this.c,l);BigBlockAudio.a[b.target.id].removeEventListener("error",this.c,l);BigBlockAudio.a[b.target.id].removeEventListener("emptied",this.c,l);BigBlockAudio.a[b.target.id].removeEventListener("stalled",this.c,l)}}BigBlockAudio.f===i&&BigBlockAudio.b(e)},canPlayType:function(b,c){try{if(typeof c===
"undefined")f(Error("A type is required"))}catch(d){BigBlockAudio.b(d.name+": "+d.message)}try{return b.canPlayType?b.canPlayType(c):"maybe"}catch(e){BigBlockAudio.b(e.name+": "+e.message)}return l},v:function(b){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(c){BigBlockAudio.b(c.name+": "+c.message)}try{this.a[b].load()}catch(d){BigBlockAudio.b(d.name+": "+d.message)}}},play:function(b,c,d){var e,h,g;if(this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(j){BigBlockAudio.b(j.name+
": "+j.message)}try{if(this.k){if(typeof this.a[this.filename]!=="undefined"){g=this.j(this.filename,i);this.f&&BigBlockAudio.b("Audio: State: "+g.e+" Message: "+g.message);if(g.e===4&&this.muted===l){e=this.o[b].K/1E3;h=this.o[b].duration>this.n?this.o[b].duration:this.n;this.pause(this.filename);this.z(this.filename,e);c&&typeof c==="function"&&c();this.a[this.filename].play();this.u=void 0;this.w=setTimeout(function(){BigBlockAudio.pause(BigBlockAudio.filename);d&&typeof d==="function"&&d()},h)}}}else if(typeof this.a[b]!==
"undefined"){g=this.j(b,this.f);this.f&&BigBlockAudio.b("Audio: State: "+g.e+" Message: "+g.message);if(g.e>=2&&this.muted===l){typeof c!=="undefined"&&c();if(typeof d!=="undefined"){h=this.p(b)*1E3;setTimeout(function(){d()},h)}this.a[b].pause();this.a[b].play()}}}catch(k){BigBlockAudio.b(k.name+": "+k.message)}}},pause:function(b,c){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(d){BigBlockAudio.b(d.name+": "+d.message)}var e=this.j(b,
i);if(e.e>2)if(typeof c!=="undefined")if(this.t(b)===l)try{this.a[b].pause()}catch(h){BigBlockAudio.b(h.name+": "+h.message)}else{e=this.r(b);var g=this.s(b);if(e.length>0&&g!==i)try{this.a[b].play()}catch(j){BigBlockAudio.b(j.name+": "+j.message)}}else try{this.a[b].pause()}catch(k){BigBlockAudio.b(k.name+": "+k.message)}else BigBlockAudio.b("Audio: "+e.message)}},t:function(b){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(c){BigBlockAudio.b(c.name+
": "+c.message)}try{return this.a[b].paused}catch(d){BigBlockAudio.b(d.name+": "+d.message)}}},r:function(b){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(c){BigBlockAudio.b(c.name+": "+c.message)}try{return this.a[b].played}catch(d){BigBlockAudio.b(d.name+": "+d.message)}}},s:function(b){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(c){BigBlockAudio.b(c.name+": "+c.message)}try{return this.a[b].ended}catch(d){BigBlockAudio.b(d.name+
": "+d.message)}}},F:function(b){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(c){BigBlockAudio.b(c.name+": "+c.message)}try{return this.a[b].playbackRate}catch(d){BigBlockAudio.b(d.name+": "+d.message)}}},j:function(b,c){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(d){BigBlockAudio.b(d.name+": "+d.message)}var e=this.a[b].readyState;if(typeof c!=="undefined"){var h;switch(e){case 0:h=
"HAVE_NOTHING: No data for the current playback position is available.";break;case 1:h="HAVE_METADATA : Enough of the resource has been obtained that the duration of the resource is available. No media data is available for the immediate current playback position.";break;case 2:h="HAVE_CURRENT_DATA: Data for the immediate current playback position is available, but not enough data is available to successfully advance the current playback position in the direction of playback.";break;case 3:h="HAVE_FUTURE_DATA: Data for the immediate current playback position is available. However, not enough data is avaialble to determine if playback will out-pace the data stream.";
break;case 4:h="HAVE_ENOUGH_DATA: All data for the immediate current playback position is available."}e={e:e,message:h}}else e=e;return e}},D:function(b,c){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(d){BigBlockAudio.b(d.name+": "+d.message)}var e=this.a[b].networkState;if(typeof c!=="undefined"){var h;switch(e){case 0:h="NETWORK_EMPTY: The element has not yet been initialized. All attributes are in their initial states.";break;case 1:h=
"NETWORK_IDLE: The element's resource selection algorithm is active and has selected a resource, but it is not actually using the network at this time.";break;case 2:h="NETWORK_LOADING: The user agent is actively trying to download data.";break;case 3:h="NETWORK_NO_SOURCE: The element's resource selection algorithm is active, but it has so not yet found a resource to use."}e={e:e,message:h}}else e=e;return e}},p:function(b){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(c){BigBlockAudio.b(c.name+
": "+c.message)}try{return this.a[b].duration}catch(d){BigBlockAudio.b(d.name+": "+d.message)}}},C:function(b){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(c){BigBlockAudio.b(c.name+": "+c.message)}try{return this.a[b].currentTime}catch(d){BigBlockAudio.b(d.name+": "+d.message)}}},z:function(b,c){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(d){BigBlockAudio.b(d.name+": "+
d.message)}try{this.a[b].currentTime=c}catch(e){BigBlockAudio.b(e.name+": "+e.message)}}},G:function(b){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"))}catch(c){BigBlockAudio.b(c.name+": "+c.message)}try{return this.a[b].volume}catch(d){BigBlockAudio.b(d.name+": "+d.message)}}},J:function(b,c){if(typeof this.a[b]!=="undefined"&&this.d){try{if(typeof b==="undefined")f(Error("An id is required"));if(typeof c==="undefined")f(Error("A volume value between 0.0 and 1.0 is required"))}catch(d){BigBlockAudio.b(d.name+
": "+d.message)}try{this.a[b].volume=c}catch(e){BigBlockAudio.b(e.name+": "+e.message)}}},H:function(){var b;if(this.d){for(b in this.a)if(this.a.hasOwnProperty(b))try{this.a[b].muted=i}catch(c){BigBlockAudio.b(c.name+": "+c.message)}this.muted=i}},L:function(){var b;if(this.d){for(b in this.a)if(this.a.hasOwnProperty(b))try{this.a[b].muted=l}catch(c){BigBlockAudio.b(c.name+": "+c.message)}this.muted=l}},b:n,q:function(b){try{if(typeof b==="undefined")f(Error("BigBlock.getMimeTypeFromFileExt(ext): An extension is required."));
else switch(b){case "aif":return["audio/x-aiff","audio/x-aiff"];case "au":case "snd":return["audio/basic"];case "ogg":return["audio/ogg"];case "mp3":return["audio/mpeg","audio/x-mpeg"];case "wav":return["audio/wav","audio/x-wav"];default:return l}}catch(c){BigBlock.b.display(c.name+": "+c.message)}}}}();